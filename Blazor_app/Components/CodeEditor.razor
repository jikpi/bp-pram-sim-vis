@using Blazor_app.Services
@inject CodeEditorService codeEditor

<style>
    .compiled-code-container {
        background-color: lightgray;
        padding: 10px;
        border-radius: 5px;
        white-space: pre;
    }

    .current-line {
        background-color: dodgerblue;
    }
</style>


@if (codeEditor.EditMode)
{
    <textarea @bind="codeEditor.Code" rows="@textAreaRows" class="form-control"></textarea>
}
else
{
    <div class="compiled-code-container">
            @foreach (var line in codeEditor.CompiledLines)
            {
            <div class="@GetLineClass(line.Key)">
                    @line.Value
            </div>
            }
    </div>
}

@code {
    private int textAreaRows => codeEditor.Code.Split('\n').Length;

    protected override void OnInitialized()
    {
        codeEditor.EditorStateChanged += StateHasChanged;
    }

    private string GetLineClass(int lineIndex)
    {
        return lineIndex == codeEditor.CurrentExecutingLine ? "current-line" : "";
    }

    public void Dispose()
    {
        codeEditor.EditorStateChanged -= StateHasChanged;
    }
}